<!DOCTYPE html>
<html>

<head>
</head>

<body>
  <pre><code class="language-klipse">
(ns pou.user)
    
(def trusted-url js/goog.html.legacyconversions.trustedResourceUrlFromString)
(def js-safe-load js/goog.net.jsloader.safeLoad)  
(def j js/applied-science.js-interop)

(def pou (atom {:params (or (js/klipse.utils.url-parameters) {})
                :editors {:main {:type :cljs
                                 :cm (aget js/klipse-editors 0)
                                 :res (aget js/klipse-results 0)}}}))

(defn cm [k method & args]
  (j.apply (-> @pou :editors k :cm) method (clj->js args)))
    
(defn load-gist [id file callback]
  (-> (str "https://api.github.com/gists/" id) js/fetch
    (.then (fn [r]
       (.then (.json r)
              (fn [j]
                (callback (-> (js->clj j :keywordize-keys true) :files ((keyword file)) :content))))))))
    
(defn eval-gist [{:keys [id file editor append-code clear-code] :or {editor :main append-code ""}}]
  (load-gist id file #(cm editor :setValue (str % "\n" append-code
                                                (when clear-code (str "\n(cm " editor " :setValue \"" clear-code "\")"))))))

(defn eval-gist-loop [f & r] 
  (eval-gist (:id f) (:file f) :append-code (if (not (empty? (rest r))) `(apply eval-gist-loop ~r) 
                                                                        `(eval-gist ~(first r)))))

(let [{:keys [params editors]} @pou] (if-let [p (params :p)] (cm :main :setValue (js/atob p)) @pou))
    
  </code></pre>
  <link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css">
  <script>
  window.klipse_settings = {
      selector: '.language-klipse'
  };
  </script>
  <script src="https://storage.googleapis.com/app.klipse.tech/plugin/js/klipse_plugin.js"></script>
</body>

</html>
